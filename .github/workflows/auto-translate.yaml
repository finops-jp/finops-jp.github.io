name: Auto Translate

on:
  workflow_dispatch:
    inputs:
      source_url:
        description: 'FinOps.org URL to translate (e.g., https://www.finops.org/framework/principles/)'
        required: true
        type: string

jobs:
  translate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          pip install -r scripts/requirements.txt
      
      - name: Translate document
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python scripts/ai-translator.py --url "${{ inputs.source_url }}"
      
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "ç¿»è¨³: ${{ inputs.source_url }}"
          title: "ğŸŒ ç¿»è¨³: ${{ inputs.source_url }}"
          body: |
            ## è‡ªå‹•ç¿»è¨³
            
            - **ã‚½ãƒ¼ã‚¹URL**: ${{ inputs.source_url }}
            - **ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³**: GitHub Models (GPT-4o)
            - **ç”Ÿæˆæ—¥æ™‚**: ${{ github.event.head_commit.timestamp }}
            
            ### ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ
            
            - [ ] ç¿»è¨³å“è³ªã®ç¢ºèª
            - [ ] Markdownæ§‹é€ ã®ç¢ºèª
            - [ ] å°‚é–€ç”¨èªã®ç¢ºèª
            - [ ] ãƒªãƒ³ã‚¯ã®ç¢ºèª
            
            ### æ³¨æ„äº‹é …
            
            ã“ã®ç¿»è¨³ã¯æ©Ÿæ¢°ç¿»è¨³ã«ã‚ˆã‚Šç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
            å†…å®¹ã‚’ç¢ºèªã®ä¸Šã€å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚
          branch: translate/${{ github.run_number }}
          delete-branch: true
          labels: |
            translation
            automated
